\input{config.tex}
%-----------------------------------%
%									%
%		Comienzo del documento		%
%									%
%-----------------------------------%
\begin{document}
%-----------------------------------%
%									%
%			Caratula				%
%									%
%-----------------------------------%
\pagestyle{fancy}
\begin{titlepage}
	\newcommand{\HRule}{\rule{\linewidth}{0.5mm}} % Defines a new command for horizontal lines, change thickness here
	\center % Centre everything on the page
	
	\thispagestyle{empty}
	\begin{center}
		\includegraphics[scale=1]{includes/banner_fiuba.pdf}\\
	\end{center}
	
	\vspace*{\stretch{1}}
	
	\textsc{\LARGE \textsc{[66.20] Organización de Computadoras}}\\[1cm]
	\textsc{\Large \textsc{Trabajo Práctico 0}}\\[0.5cm]
	\textsc{\large 2\textsuperscript{do} Cuatrimestre 2018}\\[0.5cm]
	
	\HRule\\[0.5cm]
	{\huge\bfseries Infraestructura básica}\\[0.2cm]
	\HRule\\[0.5cm]
	
	\begin{tabbing}
		\hspace{2cm}\=\+
		\underline{AUTORES}\hspace{-1cm}\=\+\hspace{1cm}\=\hspace{6cm}\=\\[0.2cm]
		
		Álvarez, Natalia Nayla.	\>\>- \#xx.xxx\\
		\>\footnotesize{$<$xxxx@xx.xx$>$}\\
		
		Husain, Ignacio Santiago.	\>\>- \#90.117\\
		\>\footnotesize{$<$santiago.husain@gmail.com$>$}\\
		
		Verstraeten, Federico.	\>\>- \#92.892\\
		\>\footnotesize{$<$federico.verstraeten@gmail.com$>$}\\
		
		\<\underline{CÁTEDRA}\\[0.2cm]
		Dr. Ing. Hamkalo, José Luis. \\
		
		\<\underline{CURSO}\\[0.2cm]
		Ing. Santi, Leandro. \\[1cm]
		
		\<\underline{FECHA DE ENTREGA}\>\>\> xx/xx/2018
		\\[0.2cm]
		
		\<\underline{FECHA DE APROBACIÓN}\>\>\> 
		\\[0.2cm]
		
		\<\underline{CALIFICACIÓN}\>\>\> 
		\\[0.2cm]
		
		\<\underline{FIRMA DE APROBACIÓN}
		\\[0.5cm]
		
	\end{tabbing}
	
	
	\vspace*{\stretch{1}}
	
	
\end{titlepage}

%-----------------------------------%
%									%
%			Indice					%
%									%
%-----------------------------------%
\clearpage

\tableofcontents							

\clearpage

%-----------------------------------%
%									%
%		Seccion:Enunciado			%
%									%
%-----------------------------------%
\includepdf[pages=1,scale=0.95,pagecommand = \section{Enunciado del trabajo práctico}\label{enunciado},offset=10 -10]{includes/tp0-2017-1q.pdf}
\includepdf[pages={2-last},scale=0.95,pagecommand = {},offset=10 -10]{includes/tp0-2017-1q.pdf}
%-----------------------------------%
%									%
%		Seccion:Objetivos			%
%									%
%-----------------------------------%
\section{Objetivos}

%-------------------------------%
%								%
%			Seccion				%
%								%
%-------------------------------%
\section{Diseño e implementación del programa}
Para código en texto usar \texttt{CODE\_1}.
Para código en bloque usar
\begin{lstlisting}[language=C, style=StyleC]
typedef struct myType_t {
int a, b;
float a1, a2;
FILE *outputStream;
} myType_t;
\end{lstlisting}

El código fuente se encuentra en el apéndice, tanto en lenguaje C (\ref{app_main}) como en MIPS32 (\ref{app_main_asm}).

Para poner figuras, usar
\begin{figure}[ht]
	\centering
	\includegraphics[scale=0.5]{./includes/fig1.jpg}
	\caption{fig1.}
	\label{fig1}
\end{figure}
y se las cita con \ref{fig1}.
%-------------------------------%
%								%
%			Seccion				%
%								%
%-------------------------------%
\section{Compilación del programa}

Debido al requerimiento de utilizar el programa en una computadora con arquitectura MIPS32, se utiliza el emulador GXemul que provee la cátedra, utilizando una máquina virtual que contiene el sistema operativo NetBSD con las herramientas necesarias para compilar el programa desarrollado; \texttt{gcc} y \texttt{make}.

Para obtener un ejecutable, se creó un archivo \texttt{makefile} cuyo contenido se puede ver en la sección \ref{app_makefile}. Para ejecutarlo, posicionarse en el directorio \texttt{src/} y ejecutar el siguiente comando:
\begin{lstlisting}
$ make
\end{lstlisting}
El mismo generará el código assembler en el archivo \quotes{main.s} y el ejecutable con nombre \texttt{tp0}. En caso de requerir que el código assembly contenga los nombres de los registros, ejecutar el siguiente comando:
\begin{lstlisting}
$ make ARGS=-mrnames
\end{lstlisting}

%-------------------------------%
%								%
%			Seccion				%
%								%
%-------------------------------%
\clearpage
\section{Pruebas}
Se realizaron pruebas de caja negra para determinar si el programa funciona como se espera.

\subsection{Ejecución con parámetros por defecto}


\subsection{Pruebas de errores en las opciones}

Se creó un script en \texttt{Bash} para automatizar las pruebas del programa. En el mismo se prueban diferentes combinaciones de las opciones de entrada para verificar si el programa es capaz de detectar errores. El código del script se encuentra en la sección \ref{app_run_tests}, y está compuesto por X tests. Los Y primeros son validaciones utilizando opciones y parámetros inválidos, donde se verifica que al intentar ejecutarlo, el programa termine y retorne un mensaje que indique el motivo de la ejecución fallida. El último test se corresponde con ejecuciones que retornan un código de éxito. Dado que el programa en este caso solo retorna un solo código, el script devuelve un mensaje de éxito, indicando la correcta ejecución del programa y que se generó correctamente el archivo de salida.

La salida del script se divide en 7 secciones, cada una con un encabezado indicando el inicio del nuevo test, y 3 o más líneas por cada test. La primer línea del test es el comando ejecutado. La segunda indica si el test fue exitoso o no mediante la etiqueta \texttt{PASSED/NOT EQUAL}, y las siguientes líneas son los resultados que produce el programa (mensajes de error, etc...). Por ejemplo, para la prueba de la opción \quotes{-file}, se tiene lo siguiente:
\begin{lstlisting}
  ./tp0 -o .
PASSED :
ERROR: Can't open output stream.
ERROR: Program exited with errors. =  ERROR: Can't open output stream.
ERROR: Program exited with errors.
\end{lstlisting}
donde se ve que el test fue satisfactorio.

\subsubsection{Salida de los tests automatizados}
A continuación se muestran las salidas de los tests automatizados, concluyendo que se verifica el correcto funcionamiento del programa.

\lstinputlisting[language=bash, style=StyleC]{src/output_tests.txt}
\clearpage

\subsection{Prueba de fuga de memoria}
El último tipo de prueba es el de la verificación de fugas de memoria. Debido al uso de memoria dinámica en el programa, se utilizó la herramienta \texttt{valgrind} \cite{valgrind} para verificar la existencia de dichas fugas. El comando utilizado fue 
\begin{lstlisting}
valgrind --tool=memcheck --leak-check=full --show-leak-kinds=all -v ./tp0 ARGUMENTOS
\end{lstlisting}
y el resultado del mismo fue 
\begin{lstlisting}
==21530== 
==21530== HEAP SUMMARY:
==21530==     in use at exit: 0 bytes in 0 blocks
==21530==   total heap usage: 3 allocs, 3 frees, 3,691,048 bytes allocated
==21530== 
==21530== All heap blocks were freed -- no leaks are possible
==21530== 
==21530== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
==21530== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
\end{lstlisting}
concluyendo que no existen fugas de memoria.

Es importante aclarar que la verificación se realizó en la máquina \texttt{host} utilizando un procesador Intel i3-6100 (x86) y el sistema operativo Ubuntu 16.04.4. Si bien \texttt{valgrind} soporta la arquitectura MIPS32, en la máquina virtual no se dispone de esta herramienta, con lo cual no fue posible realizar la verificación de fuga de memoria en dicha máquina virtual.

%-------------------------------%
%								%
%			Seccion				%
%								%
%-------------------------------%
\section{Conclusiones}

%-------------------------------%
%								%
%			Seccion				%
%								%
%-------------------------------%
\clearpage
\begin{thebibliography}{10}
	%	\bibitem{book_CompArch} Hennessy, J. L. - Patterson, D. A. - \emph{Computer Architecture: A Quantitative Approach} - 3\textsuperscript{rd} edition - Morgan Kaufmann - 2002.
	%	\bibitem{book_CompOrg} Patterson, D. A. - Hennessy, J. L. - \emph{Computer Organization and Design: The Hardware/Software Interface} - 3\textsuperscript{rd} edition - Morgan Kaufmann - 2004.
	\bibitem{book_Cprogr} Kernighan, B. W. - Ritchie, D. M. - \emph{C Programming Language} - 2\textsuperscript{nd} edition - Prentice Hall - 1988.
	\bibitem{gnu_make} \emph{GNU Make} - \hyperlink{make}{https://www.gnu.org/software/make/}
	\bibitem{valgrind} \emph{Valgrind} - \hyperlink{valgrind}{http://valgrind.org/}
	\bibitem{apuntes} \emph{Apuntes del curso 66.20 Organización de Computadoras} - Cátedra Hamkalo - Facultad de Ingeniería de la Universidad de Buenos Aires.
\end{thebibliography}
\clearpage

%-----------------------------------%
%									%
%			Seccion:Fuente			%
%									%
%-----------------------------------%
\appendix
\section{Código fuente}\label{appendix_codigo_fuente}

\subsubsection{main.c}\label{app_main}
\lstinputlisting[language=C, style=StyleC]{src/main.c}
\clearpage

\subsubsection{makefile}\label{app_makefile}
\lstinputlisting[language=bash, style=StyleC]{src/makefile.txt}
\clearpage

\subsubsection{run\_tests.sh}\label{app_run_tests}
\lstinputlisting[language=bash, style=StyleC]{src/run_tests.sh}

\subsubsection{main.s}\label{app_main_asm}
\lstinputlisting[language=C, style=StyleC]{src/main.s}
\clearpage

\end{document}
